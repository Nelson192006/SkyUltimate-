<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SkyUltimate - Super Admin Dashboard</title>
<style>
  * { margin:0; padding:0; box-sizing:border-box; font-family:'Segoe UI', sans-serif; }
  body, html { width:100%; min-height:100%; background:#C00000; }
  button { cursor:pointer; border:none; outline:none; }
  a { text-decoration:none; color:inherit; }

  #container { width:100%; min-height:100%; padding:20px; display:flex; flex-direction:column; align-items:center; position:relative; }
  #logo { width:100px; height:100px; border-radius:50%; margin-bottom:10px; }
  #welcome { font-size:1.4rem; color:white; margin-bottom:20px; text-align:center; }

  .section { width:100%; max-width:700px; background:white; border-radius:12px; padding:15px; margin-bottom:20px; box-shadow:0 2px 8px rgba(0,0,0,0.2); }
  .section h3 { color:#C00000; margin-bottom:10px; }
  .section input, .section select, .section textarea { width:100%; padding:10px; margin:5px 0 15px 0; border-radius:8px; border:1px solid #ccc; }
  .section button { width:100%; padding:12px; border-radius:12px; background:#C00000; color:white; font-weight:bold; margin-top:10px; transition:0.3s; }

  #hamburger { position:absolute; top:20px; left:20px; width:30px; height:22px; cursor:pointer; display:flex; flex-direction:column; justify-content:space-between; }
  .bar { width:100%; height:4px; background:white; border-radius:2px; }
  #menu { position:fixed; top:0; left:-300px; width:250px; height:100%; background:white; color:#C00000; box-shadow:3px 0 10px rgba(0,0,0,0.3); transition:0.3s; display:flex; flex-direction:column; padding:20px; }
  #menu h2 { margin-bottom:20px; font-size:1.2rem; }
  .menu-item { margin:10px 0; cursor:pointer; font-weight:bold; }

  .overlay { position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(255,255,255,0.95); color:#C00000; padding:40px; overflow-y:auto; display:none; }
  .overlay h2 { margin-bottom:15px; }
  .overlay p { margin-bottom:10px; line-height:1.5; }
  .close-overlay { position:absolute; top:20px; right:20px; font-weight:bold; cursor:pointer; font-size:1.2rem; }

  #logout { position:absolute; top:20px; right:20px; background:white; color:#C00000; padding:8px 12px; border-radius:8px; font-weight:bold; transition:0.3s; }
  #logout:hover { background:#f0f0f0; }
</style>
</head>
<body>
<div id="container">
  <img id="logo" src="https://raw.githubusercontent.com/Nelson192006/SkyUltimate-/fdf409b0e40dfbd432afd277b20ddb8965600fc7/logo.png" alt="Logo">
  <div id="welcome">Welcome back, Super Admin!</div>

  <!-- User Management Section -->
  <div class="section" id="user-management">
    <h3>User Management</h3>
    <div id="user-list">Loading users...</div>
  </div>

  <!-- Admin Request Queue -->
  <div class="section" id="admin-requests">
    <h3>Admin Request Queue</h3>
    <div id="request-list">Loading requests...</div>
  </div>

  <!-- Financials & Payouts -->
  <div class="section" id="financials">
    <h3>Agent Payouts</h3>
    <div id="agent-list">Loading agents...</div>
    <button id="process-payouts">Process Selected Payouts</button>
  </div>

  <!-- Platform Settings -->
  <div class="section" id="settings">
    <h3>Platform Settings</h3>
    <label>Commission (%)</label>
    <input type="number" id="commission" min="0" max="100">
    <button id="save-settings">Save Settings</button>
  </div>

  <!-- Hamburger Menu -->
  <div id="hamburger">
    <div class="bar"></div>
    <div class="bar"></div>
    <div class="bar"></div>
  </div>
  <div id="menu">
    <h2>Menu</h2>
    <div class="menu-item" id="aboutus-menu">About Us</div>
    <div class="menu-item" id="mission-menu">Mission & Vision</div>
    <div class="menu-item" id="faq-menu">FAQ / Support</div>
  </div>

  <div class="overlay" id="aboutus-overlay">
    <div class="close-overlay" onclick="closeOverlay('aboutus-overlay')">X</div>
    <h2>About Us</h2>
    <p>SkyUltimate Delivery Service, founded in 2024, ensures your packages are handled safely and delivered on time...</p>
  </div>

  <div class="overlay" id="mission-overlay">
    <div class="close-overlay" onclick="closeOverlay('mission-overlay')">X</div>
    <h2>Our Mission</h2>
    <p>To provide a seamless, reliable, and efficient delivery experience exceeding customer expectations...</p>
    <h2>Our Vision</h2>
    <p>To be the leader in delivery services known for speed, reliability, and customer satisfaction...</p>
  </div>

  <div class="overlay" id="faq-overlay">
    <div class="close-overlay" onclick="closeOverlay('faq-overlay')">X</div>
    <h2>FAQ & Support</h2>
    <p>Tracking: Use the tracking number provided in your email.</p>
    <p>Delivery hours: 9:00 AM - 6:00 PM, Mon-Sat. Special arrangements possible.</p>
    <p>WhatsApp / Phone: 09128884830</p>
    <p>Social: Instagram, Facebook (editable)</p>
  </div>

  <button id="logout">Logout</button>
</div>

<script>
  const apiURL = 'https://skyultimate-backend-api-structure.onrender.com';
  const token = sessionStorage.getItem('token');
  const name = sessionStorage.getItem('name') || 'Super Admin';
  document.getElementById('welcome').textContent = `Welcome back, ${name}!`;

  // --- User Management ---
  async function loadUsers(){
    const list = document.getElementById('user-list');
    try{
      const res = await fetch(`${apiURL}/users/all`, { headers:{ 'Authorization':`Bearer ${token}` } });
      const users = await res.json();
      list.innerHTML='';
      users.forEach(u=>{
        const div = document.createElement('div');
        div.innerHTML=`
          <p>${u.name} (${u.role})</p>
          <button onclick="suspendUser(${u.id})">Suspend</button>
          <button onclick="deleteUser(${u.id})">DELETE USER</button>
        `;
        list.appendChild(div);
      });
    }catch(e){ list.innerHTML='Failed to load users'; }
  }
  loadUsers();

  async function suspendUser(userId){
    if(!confirm('Suspend this user?')) return;
    try{ await fetch(`${apiURL}/superadmin/suspend/${userId}`, { method:'POST', headers:{'Authorization':`Bearer ${token}`} }); alert('User suspended'); loadUsers(); }
    catch(e){ alert('Failed'); }
  }

  async function deleteUser(userId){
    if(!confirm('Delete this user permanently?')) return;
    try{ await fetch(`${apiURL}/superadmin/delete/${userId}`, { method:'DELETE', headers:{'Authorization':`Bearer ${token}`} }); alert('User deleted'); loadUsers(); }
    catch(e){ alert('Failed'); }
  }

  // --- Admin Request Queue ---
  async function loadRequests(){
    const list = document.getElementById('request-list');
    try{
      const res = await fetch(`${apiURL}/superadmin/requests`, { headers:{'Authorization':`Bearer ${token}`} });
      const requests = await res.json();
      list.innerHTML='';
      requests.forEach(r=>{
        const div = document.createElement('div');
        div.innerHTML=`
          <p>Request by Admin: ${r.adminName} | Action: ${r.type}</p>
          <button onclick="approveRequest(${r.id})">Approve</button>
          <button onclick="denyRequest(${r.id})">Deny</button>
        `;
        list.appendChild(div);
      });
    }catch(e){ list.innerHTML='Failed to load requests'; }
  }
  loadRequests();

  async function approveRequest(id){ await handleRequest(id,'approve'); }
  async function denyRequest(id){ await handleRequest(id,'deny'); }
  async function handleRequest(id,action){
    try{ await fetch(`${apiURL}/superadmin/requests/${id}/${action}`, { method:'POST', headers:{'Authorization':`Bearer ${token}`} }); alert(`Request ${action}d`); loadRequests(); }
    catch(e){ alert('Failed'); }
  }

  // --- Financials & Payouts ---
  async function loadAgents(){
    const list = document.getElementById('agent-list');
    try{
      const res = await fetch(`${apiURL}/agents/all`, { headers:{'Authorization':`Bearer ${token}`} });
      const agents = await res.json();
      list.innerHTML='';
      agents.forEach(a=>{
        const div = document.createElement('div');
        div.innerHTML=`
          <input type="checkbox" class="agent-checkbox" value="${a.id}"> ${a.name} | Pending: $${a.pendingPayout}
        `;
        list.appendChild(div);
      });
    }catch(e){ list.innerHTML='Failed to load agents'; }
  }
  loadAgents();

  document.getElementById('process-payouts').addEventListener('click', async ()=>{
    const selected = Array.from(document.querySelectorAll('.agent-checkbox:checked')).map(cb=>cb.value);
    if(selected.length===0) return alert('Select at least one agent');
    try{
      await fetch(`${apiURL}/superadmin/payouts`, { method:'POST', headers:{'Authorization':`Bearer ${token}`,'Content-Type':'application/json'}, body:JSON.stringify({agentIds:selected}) });
      alert('Payouts processed'); loadAgents();
    }catch(e){ alert('Failed to process payouts'); }
  });

  // --- Platform Settings ---
  async function loadSettings(){
    try{
      const res = await fetch(`${apiURL}/superadmin/settings`, { headers:{'Authorization':`Bearer ${token}`} });
      const data = await res.json();
      document.getElementById('commission').value = data.commission;
    }catch(e){ console.log('Failed'); }
  }
  loadSettings();

  document.getElementById('save-settings').addEventListener('click', async ()=>{
    const commission = parseFloat(document.getElementById('commission').value);
    try{ await fetch(`${apiURL}/superadmin/settings`, { method:'PUT', headers:{'Authorization':`Bearer ${token}`,'Content-Type':'application/json'}, body:JSON.stringify({commission}) }); alert('Settings saved'); }
    catch(e){ alert('Failed to save'); }
  });

  // --- Hamburger Menu ---
  const hamburger = document.getElementById('hamburger');
  const menu = document.getElementById('menu');
  let menuOpen=false;
  hamburger.addEventListener('click',()=>{ menuOpen=!menuOpen; menu.style.left=menuOpen?'0':'-300px'; });

  const openOverlay = (id)=>{ document.getElementById(id).style.display='block'; menu.style.left='-300px'; menuOpen=false; }
  const closeOverlay = (id)=>{ document.getElementById(id).style.display='none'; }
  document.getElementById('aboutus-menu').addEventListener('click',()=>openOverlay('aboutus-overlay'));
  document.getElementById('mission-menu').addEventListener('click',()=>openOverlay('mission-overlay'));
  document.getElementById('faq-menu').addEventListener('click',()=>openOverlay('faq-overlay'));

  // --- Logout ---
  document.getElementById('logout').addEventListener('click',()=>{ sessionStorage.clear(); window.location.href='index.html'; });
</script>
</body>
</html>
