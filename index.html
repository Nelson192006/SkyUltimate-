<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>SkyUltimate ‚Äî Login & Registration</title>
  <!-- Tailwind CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    /* Splash fade-in animation */
    .fade-in {
      animation: fadeIn 0.5s ease forwards;
      opacity: 0;
    }
    @keyframes fadeIn {
      to { opacity: 1; }
    }
    /* Cross-fade animation */
    .cross-fade-enter {
      opacity: 0;
      transition: opacity 0.5s;
    }
    .cross-fade-enter-active {
      opacity: 1;
    }
    .cross-fade-leave {
      opacity: 1;
      transition: opacity 0.5s;
    }
    .cross-fade-leave-active {
      opacity: 0;
    }
  </style>
</head>
<body class="bg-red-600 min-h-screen flex items-center justify-center relative">

  <!-- Splash Screen -->
  <div id="splash" class="absolute inset-0 flex items-center justify-center bg-red-600 z-50">
    <img src="https://github.com/Nelson192006/SkyUltimate-/blob/62343ff3e5e556aa02ecece40e2c006fa9161c0a/logo.png?raw=true" alt="Logo" class="w-40 fade-in">
  </div>

  <!-- Login/Register Card -->
  <div id="authCard" class="hidden absolute inset-0 flex items-center justify-center">
    <div class="bg-white/80 backdrop-blur-md rounded-2xl shadow-lg p-8 w-96 max-w-full">
      <img src="https://github.com/Nelson192006/SkyUltimate-/blob/62343ff3e5e556aa02ecece40e2c006fa9161c0a/logo.png?raw=true" alt="Logo" class="w-32 mx-auto mb-6">
      
      <!-- Tabs -->
      <div class="flex justify-around mb-4">
        <button id="loginTab" class="font-semibold border-b-2 border-red-600 pb-1">Login</button>
        <button id="registerTab" class="font-semibold text-gray-500 pb-1">Register</button>
      </div>

      <!-- Forms Container -->
      <div id="formsContainer">

        <!-- Login Form -->
        <form id="loginForm" class="space-y-4">
          <select id="loginRole" class="w-full border rounded px-3 py-2">
            <option value="Customer">Customer</option>
            <option value="Agent">Agent</option>
            <option value="Admin">Admin</option>
            <option value="SuperAdmin">Super Admin</option>
          </select>
          <input type="email" id="loginEmail" placeholder="Email" class="w-full border rounded px-3 py-2" required>
          <div class="relative">
            <input type="password" id="loginPassword" placeholder="Password" class="w-full border rounded px-3 py-2 pr-10" required>
            <button type="button" id="loginTogglePassword" class="absolute right-2 top-2 text-gray-500">üëÅÔ∏è</button>
          </div>
          <a href="#" id="forgotPasswordLink" class="text-sm text-red-700 hover:underline block text-right">Forgot Password?</a>
          <button type="submit" class="w-full bg-red-600 text-white py-2 rounded hover:bg-red-700">Login</button>
          <p id="loginError" class="text-red-600 text-sm"></p>
        </form>

        <!-- Register Form -->
        <form id="registerForm" class="space-y-4 hidden">
          <input type="text" id="registerName" placeholder="Full Name" class="w-full border rounded px-3 py-2" required>
          <select id="registerRole" class="w-full border rounded px-3 py-2">
            <option value="Customer">Customer</option>
            <option value="Agent">Agent</option>
            <option value="Admin">Admin</option>
            <option value="SuperAdmin">Super Admin</option>
          </select>
          <input type="email" id="registerEmail" placeholder="Email" class="w-full border rounded px-3 py-2" required>
          <div class="relative">
            <input type="password" id="registerPassword" placeholder="Password" class="w-full border rounded px-3 py-2 pr-10" required>
            <button type="button" id="registerTogglePassword" class="absolute right-2 top-2 text-gray-500">üëÅÔ∏è</button>
          </div>
          <!-- Dynamic Bank Info Fields for Agent/Admin -->
          <div id="bankFields" class="hidden space-y-2">
            <input type="text" id="bankName" placeholder="Bank Name" class="w-full border rounded px-3 py-2">
            <input type="text" id="accountNumber" placeholder="Account Number" class="w-full border rounded px-3 py-2">
            <input type="text" id="accountHolderName" placeholder="Account Holder Name" class="w-full border rounded px-3 py-2">
            <input type="text" id="phone" placeholder="Phone Number" class="w-full border rounded px-3 py-2">
          </div>
          <button type="submit" class="w-full bg-red-600 text-white py-2 rounded hover:bg-red-700">Register</button>
          <p id="registerError" class="text-red-600 text-sm"></p>
        </form>

        <!-- Forgot Password Placeholder -->
        <div id="forgotPasswordForm" class="hidden space-y-4">
          <p class="text-gray-700">Feature coming soon. Enter your email to get a reset link.</p>
          <input type="email" id="forgotEmail" placeholder="Email" class="w-full border rounded px-3 py-2">
          <button id="sendResetLink" class="w-full bg-red-600 text-white py-2 rounded hover:bg-red-700">Send Reset Link</button>
          <p id="forgotMsg" class="text-green-600 text-sm"></p>
          <button id="backToLogin" class="w-full border border-red-600 text-red-600 py-2 rounded hover:bg-red-100">Back to Login</button>
        </div>

      </div>
    </div>
  </div>

  <script>
    const API_BASE = "https://skyultimate-backend-api-structure.onrender.com";

    async function apiFetch(path, opts = {}) {
      const token = localStorage.getItem("su_token");
      const headers = opts.headers || {};
      headers["Content-Type"] = "application/json";
      if (token) headers["Authorization"] = `Bearer ${token}`;
      const res = await fetch(API_BASE + path, { ...opts, headers });
      const data = await res.json().catch(() => null);
      if (!res.ok) throw new Error((data && data.message) || "Request failed");
      return data;
    }

    // Splash logic
    window.addEventListener('load', () => {
      setTimeout(() => {
        document.getElementById('splash').classList.add('hidden');
        document.getElementById('authCard').classList.remove('hidden');
      }, 3000);
    });

    // Tabs
    const loginTab = document.getElementById('loginTab');
    const registerTab = document.getElementById('registerTab');
    const loginForm = document.getElementById('loginForm');
    const registerForm = document.getElementById('registerForm');
    const bankFields = document.getElementById('bankFields');
    const forgotPasswordForm = document.getElementById('forgotPasswordForm');

    loginTab.addEventListener('click', () => {
      loginForm.classList.remove('hidden');
      registerForm.classList.add('hidden');
      forgotPasswordForm.classList.add('hidden');
      loginTab.classList.add('border-red-600');
      loginTab.classList.remove('text-gray-500');
      registerTab.classList.remove('border-red-600');
      registerTab.classList.add('text-gray-500');
    });

    registerTab.addEventListener('click', () => {
      loginForm.classList.add('hidden');
      registerForm.classList.remove('hidden');
      forgotPasswordForm.classList.add('hidden');
      registerTab.classList.add('border-red-600');
      registerTab.classList.remove('text-gray-500');
      loginTab.classList.remove('border-red-600');
      loginTab.classList.add('text-gray-500');
    });

    // Password toggle
    document.getElementById('loginTogglePassword').addEventListener('click', () => {
      const p = document.getElementById('loginPassword');
      p.type = p.type === 'password' ? 'text' : 'password';
    });
    document.getElementById('registerTogglePassword').addEventListener('click', () => {
      const p = document.getElementById('registerPassword');
      p.type = p.type === 'password' ? 'text' : 'password';
    });

    // Show bank fields dynamically
    document.getElementById('registerRole').addEventListener('change', (e) => {
      if (e.target.value === 'Agent' || e.target.value === 'Admin') {
        bankFields.classList.remove('hidden');
      } else {
        bankFields.classList.add('hidden');
      }
    });

    // Forgot password placeholder
    document.getElementById('forgotPasswordLink').addEventListener('click', (e) => {
      e.preventDefault();
      loginForm.classList.add('hidden');
      forgotPasswordForm.classList.remove('hidden');
    });
    document.getElementById('backToLogin').addEventListener('click', () => {
      forgotPasswordForm.classList.add('hidden');
      loginForm.classList.remove('hidden');
    });
    document.getElementById('sendResetLink').addEventListener('click', () => {
      document.getElementById('forgotMsg').innerText = "This feature is coming soon.";
    });

    // Login submit
    loginForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      const role = document.getElementById('loginRole').value;
      const email = document.getElementById('loginEmail').value;
      const password = document.getElementById('loginPassword').value;
      const errorEl = document.getElementById('loginError');
      errorEl.innerText = '';
      if (!email || !password) { errorEl.innerText = 'Please fill all fields.'; return; }
      try {
        const data = await apiFetch('/api/users/login', {
          method: 'POST',
          body: JSON.stringify({ role, email, password })
        });
        localStorage.setItem('su_token', data.token);
        localStorage.setItem('su_user', JSON.stringify(data.user));
        window.location.href = 'home.html';
      } catch(err) {
        errorEl.innerText = err.message || "Invalid credentials. Please check your role and login details.";
      }
    });

    // Register submit
    registerForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      const name = document.getElementById('registerName').value;
      const role = document.getElementById('registerRole').value;
      const email = document.getElementById('registerEmail').value;
      const password = document.getElementById('registerPassword').value;
      const bankName = document.getElementById('bankName').value;
      const accountNumber = document.getElementById('accountNumber').value;
      const accountHolderName = document.getElementById('accountHolderName').value;
      const phone = document.getElementById('phone').value;
      const errorEl = document.getElementById('registerError');
      errorEl.innerText = '';
      if (!name || !email || !password) { errorEl.innerText = 'Please fill all required fields.'; return; }
      const payload = { name, role, email, password };
      if (role === 'Agent' || role === 'Admin') {
        payload.bankName = bankName;
        payload.accountNumber = accountNumber;
        payload.accountHolderName = accountHolderName;
        payload.phone = phone;
      }
      try {
        await apiFetch('/api/users/register', { method: 'POST', body: JSON.stringify(payload) });
        // auto switch to login tab with email prefilled
        loginTab.click();
        document.getElementById('loginEmail').value = email;
        document.getElementById('loginPassword').value = '';
        errorEl.innerText = "Registration successful! Please login.";
      } catch(err) {
        errorEl.innerText = err.message || "An account with this email already exists, Login.";
      }
    });

  </script>
</body>
</html>
