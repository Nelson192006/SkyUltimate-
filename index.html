<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>SkyUltimate ‚Äì Sign In / Register</title>
<style>
  :root {
    --red: #C00000;
    --white: #ffffff;
    --muted: #6b7280;
    --card-shadow: 0 10px 30px rgba(0,0,0,0.18);
  }
  * { box-sizing: border-box; }
  body {
    margin:0;
    font-family: Inter, system-ui, "Segoe UI", Roboto, Arial, sans-serif;
    background: var(--red);
    color: var(--white);
    min-height: 100vh;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 24px;
  }

  /* Splash */
  #splash {
    position: fixed;
    inset: 0;
    background: var(--red);
    display: flex;
    align-items: center;
    justify-content: center;
    flex-direction: column;
    z-index: 9999;
    opacity: 1;
    animation: splashHold 3s ease forwards;
  }
  .splash-logo {
    width: 220px;
    height: 220px;
    border-radius: 999px;
    background: var(--white);
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: 0 0 0 8px rgba(255,255,255,0.25), 0 30px 80px rgba(0,0,0,0.25);
    overflow: hidden;
  }
  .splash-logo img { width: 160px; height: 160px; object-fit: contain; display:block; }

  @keyframes splashHold {
    0% { opacity: 1 }
    85% { opacity: 1 }
    100% { opacity: 0; visibility: hidden }
  }

  /* Layout */
  .wrap { width: 100%; max-width: 560px; margin: 0 auto; }
  .brand { display:flex; flex-direction:column; align-items:center; gap:8px; margin-bottom:18px; }
  .brand img { width: 160px; height: 160px; border-radius: 50%; background: #fff; object-fit: contain; padding:8px; }
  .brand .muted { color: var(--white); font-weight:700; font-size:1.05rem; }

  .card {
    background: #fff;
    color: #000;
    border-radius: 18px;
    padding: 22px;
    box-shadow: var(--card-shadow);
  }

  .tabs { display:flex; gap:8px; margin-bottom:14px; }
  .tabs button {
    flex:1; padding:12px; border-radius:999px; border:1px solid #e5e7eb;
    background:#fff; font-weight:800; cursor:pointer;
  }
  .tabs button.active { background:var(--red); border-color:var(--red); color:#fff; }

  .row { display:grid; gap:12px; margin:10px 0; }
  label { font-size:.9rem; color:#374151; font-weight:700; }
  input, select, textarea {
    width:100%; padding:12px 14px; border:1px solid #e5e7eb; border-radius:12px; background:#fff; font-size:15px; color:#000;
  }
  textarea { min-height:80px; resize:vertical; }

  .field { display:grid; gap:6px; }
  .inline { display:flex; gap:8px; align-items:center; justify-content:space-between; flex-wrap:wrap; }
  .btn { background:var(--red); color:#fff; border:none; padding:12px 16px; border-radius:12px; cursor:pointer; font-weight:800; }
  .muted { color:var(--muted); font-size:.92rem; }
  .error { color:#b91c1c; font-weight:700; }
  .success { color:#047857; font-weight:700; }
  .hint { font-size:.82rem; color:#6b7280; }
  .eye { position:absolute; right:12px; top:50%; transform:translateY(-50%); cursor:pointer; color:#6b7280; user-select:none; }
  .rel { position:relative; }
  footer { margin-top:18px; text-align:center; color:var(--white); font-size:.9rem; }

  @media (max-width:420px) {
    .brand img { width: 110px; height:110px; }
    .splash-logo { width:160px; height:160px; }
    .splash-logo img { width:110px; height:110px; }
  }

  .info { font-size:.85rem; color:#6b7280; margin-top:8px; display:block; }

  .msg { margin-top:10px; font-size:0.95rem; text-align:center; }
  .msg.error { color:#b91c1c; }
  .msg.success { color:#047857; }
</style>
</head>
<body>
  <!-- Splash -->
  <div id="splash">
    <div class="splash-logo">
      <img src="https://raw.githubusercontent.com/Nelson192006/SkyUltimate-/1ba03de15cbb4029e67334b7ccc7f4afcf11638f/logo.png" alt="SkyUltimate logo">
    </div>
    <div style="height:10px;"></div>
    <div style="color:var(--white); font-weight:700; font-size:1.15rem;">Swift ‚Ä¢ Reliable ‚Ä¢ Secure</div>
  </div>

  <div class="wrap" id="app" style="display:none;">
    <div class="brand">
      <img src="https://raw.githubusercontent.com/Nelson192006/SkyUltimate-/1ba03de15cbb4029e67334b7ccc7f4afcf11638f/logo.png" alt="SkyUltimate">
      <div class="muted">Welcome to SkyUltimate Delivery Service</div>
    </div>

    <div class="card">
      <div class="tabs" role="tablist" aria-label="Auth tabs">
        <button id="tabLogin" class="active" role="tab">Login</button>
        <button id="tabRegister" role="tab">Register</button>
      </div>

      <!-- LOGIN VIEW -->
      <div id="loginView">
        <div class="row">
          <div class="field">
            <label>Role</label>
            <select id="loginRole">
              <option value="">Select your role</option>
              <option value="customer">Customer</option>
              <option value="agent">Agent</option>
              <option value="admin">Admin</option>
              <option value="superadmin">Super Admin</option>
            </select>
          </div>

          <div class="field">
            <label>Email</label>
            <input id="loginEmail" type="email" placeholder="Enter your email" />
          </div>

          <div class="field rel">
            <label>Password</label>
            <input id="loginPassword" type="password" placeholder="Enter your password" />
            <span class="eye" data-toggle="#loginPassword">üëÅ</span>
          </div>
        </div>

        <div class="inline" style="margin-top:10px;">
          <a href="#" class="muted" id="forgot">Forgot Password?</a>
          <button class="btn" id="loginBtn">Login</button>
        </div>

        <div id="loginMsg" class="msg" aria-live="polite"></div>
      </div>

      <!-- REGISTER VIEW -->
      <div id="registerView" style="display:none;">
        <div class="row">
          <div class="field">
            <label>Role</label>
            <select id="regRole"></select>
            <div class="hint">Super-admin will appear only if allowed for first-time setup.</div>
          </div>

          <div class="field">
            <label>Full Name</label>
            <input id="regName" type="text" placeholder="Full name" />
          </div>

          <div class="field">
            <label>Email</label>
            <input id="regEmail" type="email" placeholder="Email address" />
          </div>

          <div class="field rel">
            <label>Password</label>
            <input id="regPassword" type="password" placeholder="Create a password" />
            <span class="eye" data-toggle="#regPassword">üëÅ</span>
          </div>

          <div id="agentMore" style="display:none;">
            <div class="field">
              <label>Phone Number</label>
              <input id="regPhone" type="tel" placeholder="+234 801 234 5678" />
            </div>
            <div class="field">
              <label>Delivery Vehicle</label>
              <select id="regVehicle">
                <option value="">Select</option>
                <option>Motorcycle</option><option>Car</option><option>Van</option><option>Bicycle</option>
              </select>
            </div>
            <div class="field">
              <label>Bank Name</label>
              <input id="regBankName" type="text" placeholder="Bank name" />
            </div>
            <div class="field">
              <label>Account Number</label>
              <input id="regAccountNumber" type="text" placeholder="1234567890" />
            </div>
            <div class="field">
              <label>Account Holder Name</label>
              <input id="regAccountName" type="text" placeholder="Account holder" />
            </div>
          </div>
        </div>

        <div class="inline" style="margin-top:10px;">
          <span></span>
          <button class="btn" id="registerBtn">Create Account</button>
        </div>

        <div id="regMsg" class="msg" aria-live="polite"></div>
      </div>
    </div>

    <div style="margin-top:12px;">
      <small class="info" id="modeInfo"></small>
      <footer>¬© <span id="yr"></span> SkyUltimate Delivery Service</footer>
    </div>
  </div>

  <script>
  document.addEventListener("DOMContentLoaded", async () => {
    const API = "https://skyultimate-backend-api-structure.onrender.com";
    const HOME_URLS = {
      customer: "/customer.html",
      agent: "/agent.html",
      admin: "/admin.html",
      superadmin: "/superadmin.html"
    };

    const $ = s => document.querySelector(s);
    const showMsg = (el, text, cls="msg") => { if(!el) return; el.textContent = text; el.className = cls; };

    $("#yr").textContent = new Date().getFullYear();

    // Splash
    setTimeout(()=> {
      $("#splash").style.display = "none";
      $("#app").style.display = "block";
    }, 3000);

    // password eye toggles
    document.querySelectorAll(".eye").forEach(item=>{
      item.addEventListener("click", ()=> {
        const input = document.querySelector(item.dataset.toggle);
        if(!input) return;
        input.type = input.type === "password" ? "text" : "password";
      });
    });

    // Tabs
    $("#tabLogin").addEventListener("click", ()=>{
      $("#tabLogin").classList.add("active");
      $("#tabRegister").classList.remove("active");
      $("#loginView").style.display = "block";
      $("#registerView").style.display = "none";
    });
    $("#tabRegister").addEventListener("click", ()=>{
      $("#tabRegister").classList.add("active");
      $("#tabLogin").classList.remove("active");
      $("#registerView").style.display = "block";
      $("#loginView").style.display = "none";
    });

    // Load roles dynamically
    const sel = $("#regRole");
    try {
      const res = await fetch(`${API}/auths/config/public`);
      const conf = await res.json();
      sel.innerHTML = "";
      sel.append(new Option("Customer","customer"));
      sel.append(new Option("Agent","agent"));
      if(conf.allowAdminRegistration) sel.append(new Option("Admin","admin"));
      if(!conf.hasAnyUser) sel.append(new Option("Super-admin","superadmin"));
    } catch(e){
      sel.innerHTML = "";
      sel.append(new Option("Customer","customer"));
      sel.append(new Option("Agent","agent"));
    }

    $("#regRole").addEventListener("change", ()=> {
      $("#agentMore").style.display = $("#regRole").value === "agent" ? "block" : "none";
    });

    // Guard: auto redirect if token valid
    (async function guard(){
      const token = localStorage.getItem("token");
      if(!token) return;
      try {
        const res = await fetch(`${API}/auths/me`, { headers: { Authorization: `Bearer ${token}` }});
        if(!res.ok) throw new Error();
        const user = await res.json();
        window.location.href = HOME_URLS[user.role] || HOME_URLS.customer;
      } catch(e){ localStorage.removeItem("token"); localStorage.removeItem("user"); }
    })();

    // Login
    $("#loginBtn").addEventListener("click", async ()=>{
      const role = $("#loginRole").value.trim();
      const email = $("#loginEmail").value.trim();
      const password = $("#loginPassword").value;
      const msgEl = $("#loginMsg");
      if(!role || !email || !password) return showMsg(msgEl, "Complete all fields","msg error");
      showMsg(msgEl, "Authenticating...");
      try {
        const res = await fetch(`${API}/auths/login`, {
          method:"POST",
          headers: {"Content-Type":"application/json"},
          body: JSON.stringify({ role,email,password })
        });
        const data = await res.json();
        if(!res.ok) return showMsg(msgEl, data.message||"Invalid credentials","msg error");
        localStorage.setItem("token", data.token);
        localStorage.setItem("user", JSON.stringify(data.user));
        showMsg(msgEl,"Login successful","msg success");
        setTimeout(()=>window.location.href = HOME_URLS[data.user.role],500);
      } catch(e){ showMsg(msgEl,"Network error","msg error"); }
    });

    // Register
    $("#registerBtn").addEventListener("click", async ()=>{
      const role = $("#regRole").value.trim();
      const fullName = $("#regName").value.trim();
      const email = $("#regEmail").value.trim();
      const password = $("#regPassword").value;
      const msgEl = $("#regMsg");
      if(!role||!fullName||!email||!password) return showMsg(msgEl,"Complete all fields","msg error");
      const payload = { role, fullName, email, password };
      if(role==="agent") {
        payload.phone = $("#regPhone").value.trim();
        payload.vehicleType = $("#regVehicle").value.trim();
        payload.bankName = $("#regBankName").value.trim();
        payload.accountNumber = $("#regAccountNumber").value.trim();
        payload.accountName = $("#regAccountName").
