<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SkyUltimate Delivery</title>
<style>
  * { margin: 0; padding: 0; box-sizing: border-box; font-family: Arial, sans-serif; }
  body, html { width: 100%; height: 100%; }

  /* Splash Screen */
  #splash {
    display: flex;
    align-items: center;
    justify-content: center;
    background-color: #C00000;
    width: 100%;
    height: 100%;
    position: fixed;
    top: 0;
    left: 0;
    z-index: 1000;
    opacity: 1;
    transition: opacity 0.5s ease;
  }
  #splash img {
    width: 220px;
    height: 220px;
    border-radius: 50%;
    animation: fadeIn 0.5s ease forwards;
  }
  @keyframes fadeIn {
    from { opacity: 0; transform: scale(0.8); }
    to { opacity: 1; transform: scale(1); }
  }

  /* Main App */
  #app {
    display: none;
    background-color: #C00000;
    min-height: 100vh;
    display: flex;
    justify-content: center;
    align-items: center;
  }

  /* Card */
  .card {
    background: rgba(255,255,255,0.95);
    border-radius: 12px;
    padding: 30px;
    width: 350px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.2);
  }

  /* Logo inside App */
  #app-logo {
    display: block;
    margin: 0 auto 20px;
    width: 160px;
    height: 160px;
    border-radius: 50%;
  }

  /* Tabs */
  .tabs { display: flex; margin-bottom: 20px; cursor: pointer; }
  .tab { flex: 1; text-align: center; padding: 10px; font-weight: bold; }
  .active-tab { border-bottom: 3px solid #C00000; }

  /* Form fields */
  .form-group { margin-bottom: 15px; position: relative; }
  .form-group input, .form-group select {
    width: 100%;
    padding: 10px 35px 10px 10px;
    border-radius: 8px;
    border: 1px solid #ccc;
  }
  .form-group .toggle-password {
    position: absolute;
    right: 10px;
    top: 50%;
    transform: translateY(-50%);
    cursor: pointer;
  }

  /* Buttons */
  button {
    width: 100%;
    padding: 12px;
    border: none;
    border-radius: 8px;
    background-color: #C00000;
    color: white;
    font-size: 16px;
    cursor: pointer;
  }

  /* Error messages */
  .error { color: red; font-size: 14px; margin-top: 5px; display: none; }

  /* Forgot password */
  .forgot-password {
    display: block;
    text-align: right;
    font-size: 13px;
    margin-top: -10px;
    margin-bottom: 15px;
    text-decoration: underline;
    cursor: pointer;
  }

</style>
</head>
<body>

<!-- Splash Screen -->
<div id="splash">
  <img src="https://raw.githubusercontent.com/Nelson192006/SkyUltimate-/fdf409b0e40dfbd432afd277b20ddb8965600fc7/logo.png" alt="SkyUltimate Logo" />
</div>

<!-- Main App -->
<div id="app">
  <div class="card">
    <img src="https://raw.githubusercontent.com/Nelson192006/SkyUltimate-/fdf409b0e40dfbd432afd277b20ddb8965600fc7/logo.png" alt="Logo" id="app-logo">
    
    <div class="tabs">
      <div class="tab active-tab" id="login-tab">Login</div>
      <div class="tab" id="register-tab">Register</div>
    </div>

    <!-- Login Form -->
    <div id="login-form">
      <div class="form-group">
        <select id="login-role">
          <option value="">Select Role</option>
          <option value="Customer">Customer</option>
          <option value="Agent">Agent</option>
          <option value="Admin">Admin</option>
          <option value="Super-admin">Super-admin</option>
        </select>
      </div>
      <div class="form-group">
        <input type="email" id="login-email" placeholder="Enter your email">
      </div>
      <div class="form-group">
        <input type="password" id="login-password" placeholder="Enter your password">
        <span class="toggle-password" onclick="togglePassword('login-password', this)">üëÅÔ∏è</span>
      </div>
      <span class="forgot-password" onclick="forgotPassword()">Forgot Password?</span>
      <button onclick="login()">Login</button>
      <div class="error" id="login-error"></div>
    </div>

    <!-- Register Form -->
    <div id="register-form" style="display:none;">
      <div class="form-group">
        <select id="register-role" onchange="renderFields()">
          <option value="">Select Role</option>
          <option value="Customer">Customer</option>
          <option value="Agent">Agent</option>
        </select>
      </div>
      <div id="dynamic-fields"></div>
      <button onclick="register()">Register</button>
      <div class="error" id="register-error"></div>
    </div>

  </div>
</div>

<script>
  // Splash Screen
  window.addEventListener('DOMContentLoaded', () => {
    setTimeout(() => {
      const splash = document.getElementById('splash');
      splash.style.opacity = 0;
      setTimeout(() => {
        splash.style.display = 'none';
        document.getElementById('app').style.display = 'flex';
      }, 500);
    }, 3000);
  });

  // Tab switching
  document.getElementById('login-tab').addEventListener('click', () => {
    document.getElementById('login-form').style.display = 'block';
    document.getElementById('register-form').style.display = 'none';
    document.getElementById('login-tab').classList.add('active-tab');
    document.getElementById('register-tab').classList.remove('active-tab');
  });
  document.getElementById('register-tab').addEventListener('click', () => {
    document.getElementById('login-form').style.display = 'none';
    document.getElementById('register-form').style.display = 'block';
    document.getElementById('register-tab').classList.add('active-tab');
    document.getElementById('login-tab').classList.remove('active-tab');
  });

  // Toggle password visibility
  function togglePassword(fieldId, icon) {
    const field = document.getElementById(fieldId);
    if(field.type === 'password') {
      field.type = 'text';
      icon.textContent = 'üôà';
    } else {
      field.type = 'password';
      icon.textContent = 'üëÅÔ∏è';
    }
  }

  // Dynamic fields for registration
  function renderFields() {
    const role = document.getElementById('register-role').value;
    const container = document.getElementById('dynamic-fields');
    container.innerHTML = '';
    if(role === 'Customer') {
      container.innerHTML = `
        <div class="form-group"><input type="text" id="reg-fullname" placeholder="Full Name"></div>
        <div class="form-group"><input type="email" id="reg-email" placeholder="Email"></div>
        <div class="form-group"><input type="password" id="reg-password" placeholder="Password">
          <span class="toggle-password" onclick="togglePassword('reg-password', this)">üëÅÔ∏è</span>
        </div>
      `;
    }
    if(role === 'Agent') {
      container.innerHTML = `
        <div class="form-group"><input type="text" id="reg-fullname" placeholder="Full Name"></div>
        <div class="form-group"><input type="email" id="reg-email" placeholder="Email"></div>
        <div class="form-group"><input type="password" id="reg-password" placeholder="Password">
          <span class="toggle-password" onclick="togglePassword('reg-password', this)">üëÅÔ∏è</span>
        </div>
        <div class="form-group"><input type="text" id="reg-phone" placeholder="Phone Number"></div>
        <div class="form-group"><input type="text" id="reg-bank" placeholder="Bank Details"></div>
      `;
    }
  }

  // API Base
  const API_BASE = 'https://skyultimate-backend-api-structure.onrender.com';

  // Login function
  async function login() {
    const role = document.getElementById('login-role').value;
    const email = document.getElementById('login-email').value;
    const password = document.getElementById('login-password').value;
    const errorDiv = document.getElementById('login-error');
    errorDiv.style.display = 'none';
    if(!role || !email || !password) {
      errorDiv.textContent = 'Please fill in all fields.';
      errorDiv.style.display = 'block';
      return;
    }
    try {
      const res = await fetch(`${API_BASE}/auth/login`, {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({ role, email, password })
      });
      const data = await res.json();
      if(res.ok) {
        sessionStorage.setItem('token', data.token);
        sessionStorage.setItem('role', data.role);
        window.location.href = 'home.html';
      } else {
        errorDiv.textContent = data.message || 'Invalid credentials. Please check your role and login details';
        errorDiv.style.display = 'block';
      }
    } catch(err) {
      errorDiv.textContent = 'Server error. Try again later.';
      errorDiv.style.display = 'block';
    }
  }

  // Register function
  async function register() {
    const role = document.getElementById('register-role').value;
    const fullname = document.getElementById('reg-fullname')?.value;
    const email = document.getElementById('reg-email')?.value;
    const password = document.getElementById('reg-password')?.value;
    const phone = document.getElementById('reg-phone')?.value;
    const bank = document.getElementById('reg-bank')?.value;
    const errorDiv = document.getElementById('register-error');
    errorDiv.style.display = 'none';
    if(!role || !fullname || !email || !password || (role==='Agent' && (!phone || !bank))) {
      errorDiv.textContent = 'Please fill in all required fields.';
      errorDiv.style.display = 'block';
      return;
    }
    try {
      const payload = { role, fullname, email, password };
      if(role==='Agent'){ payload.phone = phone; payload.bank = bank; }
      const res = await fetch(`${API_BASE}/auth/register`, {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify(payload)
      });
      const data = await res.json();
      if(res.ok) {
        sessionStorage.setItem('token', data.token);
        sessionStorage.setItem('role', data.role);
        window.location.href = 'home.html';
      } else {
        errorDiv.textContent = data.message || 'Registration failed. Try login if already registered.';
        errorDiv.style.display = 'block';
      }
    } catch(err) {
      errorDiv.textContent = 'Server error. Try again later.';
      errorDiv.style.display = 'block';
    }
  }

  function forgotPassword() {
    alert('Redirect to forgot password page (to be implemented)');
  }

</script>

</body>
  </html>
